@model MVC.Models.UserManagement.UserManagementViewModel

@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Users Management";
}

<div class="bg-white rounded-xl shadow-sm border border-zinc-200 overflow-hidden">

    <!-- Header -->
    <div class="px-6 py-4 border-b border-zinc-200 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-zinc-900 flex items-center gap-2">
            <i class="fas fa-users"></i>
            Manage Users
        </h2>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-zinc-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-zinc-500 uppercase">User</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-zinc-500 uppercase">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-zinc-500 uppercase">Phone</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-zinc-500 uppercase">Role</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-zinc-500 uppercase">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-zinc-500 uppercase">Created At</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-zinc-500 uppercase">Actions</th>
                </tr>
            </thead>

            <tbody class="bg-white divide-y divide-zinc-200">
                @if (Model.Users != null && Model.Users.Any())
                {
                    foreach (var user in Model.Users)
                    {
                        <tr class="hover:bg-zinc-50 transition-colors">
                            <!-- User -->
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-9 h-9 rounded-full bg-indigo-600 flex items-center justify-center text-white font-semibold text-sm">
                                        @(string.IsNullOrEmpty(user.FullName)
                                                                        ? "U"
                                                                        : user.FullName.Substring(0, 1).ToUpper())
                                                                                                              </div>
                                                                                                              <span class="font-semibold text-zinc-900">
                                                                                                                  @user.FullName
                                                                                                              </span>
                                                                                                          </div>
                                                                                                      </td>

                            <!-- Email -->
                            <td class="px-6 py-4 text-sm text-zinc-600">
                                @user.Email
                            </td>

                            <!-- Phone -->
                            <td class="px-6 py-4 text-sm text-zinc-600">
                                @user.PhoneNumber
                            </td>

                            <!-- Role -->
                            <td class="px-6 py-4">
                                <span class="inline-flex px-3 py-1 rounded-full text-xs font-semibold
                        @(user.Role.ToString() == "Admin"
                                                                                        ? "bg-emerald-100 text-emerald-700"
                                                                                        : user.Role.ToString() == "Student"
                                                                                            ? "bg-red-100 text-red-700"
                                                                                            : "bg-amber-100 text-amber-700")">
                                                                                                                          @user.Role
                                                                                                                      </span>
                                                                                                                  </td>

                            <!-- Status -->
                            <td class="px-6 py-4">
                                <span class="inline-flex px-3 py-1 rounded-full text-xs font-semibold
                                                @(user.IsVerfied
                                                                                                                ? "bg-emerald-100 text-emerald-700"
                                                                                                                : "bg-red-100 text-red-700")">
                            @(user.IsVerfied ? "Verified" : "Unverified")
                        </span>
                    </td>

                            <!-- Created -->
                            <td class="px-6 py-4 text-sm text-zinc-600">
                                @user.CreatedAt.ToString("dd/MM/yyyy")
                            </td>

                            <!-- Actions -->
                            <td class="px-6 py-4">
                                <div class="flex gap-2">
                                    <button type="button"
                                            onclick="openEditModal(
                                                    '@user.UserId',
                                                    '@user.FullName',
                                                    '@user.Email',
                                                    '@user.PhoneNumber',
                                                    '@user.Role'
                                                )"
                                            class="inline-flex items-center gap-1 px-3 py-2 bg-blue-50 text-blue-600 text-sm font-medium rounded-lg hover:bg-blue-600 hover:text-white">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </button>

                                    <form asp-action="DeleteUser"
                                          method="post"
                                          onsubmit="return confirm('Are you sure you want to delete this user?')">
                                        <input type="hidden" name="userId" value="@user.UserId" />
                                        <button type="submit"
                                                class="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-600 hover:text-white">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                                }
                }
                else
                {
                    <tr>
                        <td colspan="7" class="text-center py-6 text-zinc-500">
                            No users found
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="px-6 py-4 border-t border-zinc-200 flex items-center justify-between">
        <div class="text-sm text-zinc-500">
            Showing
            @(((Model.PageNumber - 1) * Model.PageSize) + 1)
            -
            @(Math.Min(Model.PageNumber * Model.PageSize, Model.TotalCount))
            of @Model.TotalCount users
        </div>

        <div class="flex gap-1">
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <a asp-action="Users"
                   asp-route-pageNumber="@i"
                   asp-route-pageSize="@Model.PageSize"
                   class="px-3 py-2 text-sm font-medium rounded-lg
                           @(i == Model.PageNumber
                                                              ? "bg-indigo-600 text-white"
                                                              : "bg-white border border-zinc-300 text-zinc-700 hover:bg-zinc-50")">
                @i
            </a>
                        }
        </div>
    </div>
</div>
<!-- EDIT USER MODAL -->
<div id="editModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white w-full max-w-lg rounded-xl p-6">
        <h3 class="text-lg font-semibold mb-4">Edit User</h3>

        <form asp-action="UpdateUser" method="post">
            <input type="hidden" id="userId" name="userId" />

            <div class="mb-3">
                <label class="block text-sm font-medium">Full Name</label>
                <input type="text" id="fullName" name="fullName"
                       class="w-full border rounded-lg px-3 py-2" required />
            </div>

            <div class="mb-3">
                <label class="block text-sm font-medium">Email</label>
                <input type="email" id="email" name="email"
                       class="w-full border rounded-lg px-3 py-2" required />
            </div>

            <div class="mb-3">
                <label class="block text-sm font-medium">Phone</label>
                <input type="text" id="phoneNumber" name="phoneNumber"
                       class="w-full border rounded-lg px-3 py-2" />
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium">Role</label>
                <select id="role" name="role"
                        class="w-full border rounded-lg px-3 py-2">
                    <option value="Student">Student</option>
                    <option value="Instructor">Instructor</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>

            <div class="flex justify-end gap-2">
                <button type="button"
                        onclick="closeEditModal()"
                        class="px-4 py-2 bg-gray-200 rounded-lg">
                    Cancel
                </button>

                <button type="submit"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg">
                    Save
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function openEditModal(id, name, email, phone, role) {
        document.getElementById('userId').value = id;
        document.getElementById('fullName').value = name;
        document.getElementById('email').value = email;
        document.getElementById('phoneNumber').value = phone;
        document.getElementById('role').value = role;
        const modal = document.getElementById('editModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }
    function closeEditModal() {
        const modal = document.getElementById('editModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }
</script>
